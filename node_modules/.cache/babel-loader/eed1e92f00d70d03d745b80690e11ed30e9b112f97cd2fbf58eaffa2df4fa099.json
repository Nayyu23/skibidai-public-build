{"ast":null,"code":"import _classCallCheck from \"C:/Users/Nayyu/Desktop/skibidai-public-build/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/Users/Nayyu/Desktop/skibidai-public-build/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"C:/Users/Nayyu/Desktop/skibidai-public-build/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"C:/Users/Nayyu/Desktop/skibidai-public-build/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport { Loader, FileLoader, LoadingManager, Group } from \"three\";\nimport { ColladaLoader } from \"./ColladaLoader.js\";\nimport { unzipSync } from \"fflate\";\nvar KMZLoader = /*#__PURE__*/function (_Loader) {\n  _inherits(KMZLoader, _Loader);\n  var _super = _createSuper(KMZLoader);\n  function KMZLoader(manager) {\n    _classCallCheck(this, KMZLoader);\n    return _super.call(this, manager);\n  }\n  _createClass(KMZLoader, [{\n    key: \"load\",\n    value: function load(url, onLoad, onProgress, onError) {\n      var scope = this;\n      var loader = new FileLoader(scope.manager);\n      loader.setPath(scope.path);\n      loader.setResponseType(\"arraybuffer\");\n      loader.setRequestHeader(scope.requestHeader);\n      loader.setWithCredentials(scope.withCredentials);\n      loader.load(url, function (text) {\n        try {\n          onLoad(scope.parse(text));\n        } catch (e) {\n          if (onError) {\n            onError(e);\n          } else {\n            console.error(e);\n          }\n          scope.manager.itemError(url);\n        }\n      }, onProgress, onError);\n    }\n  }, {\n    key: \"parse\",\n    value: function parse(data) {\n      function findFile(url) {\n        for (var path in zip) {\n          if (path.substr(-url.length) === url) {\n            return zip[path];\n          }\n        }\n      }\n      var manager = new LoadingManager();\n      manager.setURLModifier(function (url) {\n        var image = findFile(url);\n        if (image) {\n          console.log(\"Loading\", url);\n          var blob = new Blob([image.buffer], {\n            type: \"application/octet-stream\"\n          });\n          return URL.createObjectURL(blob);\n        }\n        return url;\n      });\n      var zip = unzipSync(new Uint8Array(data));\n      if (zip[\"doc.kml\"]) {\n        var xml = new DOMParser().parseFromString(fflate.strFromU8(zip[\"doc.kml\"]), \"application/xml\");\n        var model = xml.querySelector(\"Placemark Model Link href\");\n        if (model) {\n          var loader = new ColladaLoader(manager);\n          return loader.parse(fflate.strFromU8(zip[model.textContent]));\n        }\n      } else {\n        console.warn(\"KMZLoader: Missing doc.kml file.\");\n        for (var path in zip) {\n          var extension = path.split(\".\").pop().toLowerCase();\n          if (extension === \"dae\") {\n            var _loader = new ColladaLoader(manager);\n            return _loader.parse(fflate.strFromU8(zip[path]));\n          }\n        }\n      }\n      console.error(\"KMZLoader: Couldn't find .dae file.\");\n      return {\n        scene: new Group()\n      };\n    }\n  }]);\n  return KMZLoader;\n}(Loader);\nexport { KMZLoader };","map":{"version":3,"names":["KMZLoader","_Loader","_inherits","_super","_createSuper","manager","_classCallCheck","call","_createClass","key","value","load","url","onLoad","onProgress","onError","scope","loader","FileLoader","setPath","path","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","text","parse","e","console","error","itemError","data","findFile","zip","substr","length","LoadingManager","setURLModifier","image","log","blob","Blob","buffer","type","URL","createObjectURL","unzipSync","Uint8Array","xml","DOMParser","parseFromString","fflate","strFromU8","model","querySelector","ColladaLoader","textContent","warn","extension","split","pop","toLowerCase","scene","Group","Loader"],"sources":["C:\\Users\\Nayyu\\Desktop\\skibidai-public-build\\node_modules\\src\\loaders\\KMZLoader.js"],"sourcesContent":["import { FileLoader, Group, Loader, LoadingManager } from 'three'\nimport { ColladaLoader } from '../loaders/ColladaLoader'\nimport { unzipSync } from 'fflate'\n\nclass KMZLoader extends Loader {\n  constructor(manager) {\n    super(manager)\n  }\n\n  load(url, onLoad, onProgress, onError) {\n    const scope = this\n\n    const loader = new FileLoader(scope.manager)\n    loader.setPath(scope.path)\n    loader.setResponseType('arraybuffer')\n    loader.setRequestHeader(scope.requestHeader)\n    loader.setWithCredentials(scope.withCredentials)\n    loader.load(\n      url,\n      function (text) {\n        try {\n          onLoad(scope.parse(text))\n        } catch (e) {\n          if (onError) {\n            onError(e)\n          } else {\n            console.error(e)\n          }\n\n          scope.manager.itemError(url)\n        }\n      },\n      onProgress,\n      onError,\n    )\n  }\n\n  parse(data) {\n    function findFile(url) {\n      for (const path in zip) {\n        if (path.substr(-url.length) === url) {\n          return zip[path]\n        }\n      }\n    }\n\n    const manager = new LoadingManager()\n    manager.setURLModifier(function (url) {\n      const image = findFile(url)\n\n      if (image) {\n        console.log('Loading', url)\n\n        const blob = new Blob([image.buffer], { type: 'application/octet-stream' })\n        return URL.createObjectURL(blob)\n      }\n\n      return url\n    })\n\n    //\n\n    const zip = unzipSync(new Uint8Array(data))\n\n    if (zip['doc.kml']) {\n      const xml = new DOMParser().parseFromString(fflate.strFromU8(zip['doc.kml']), 'application/xml')\n      const model = xml.querySelector('Placemark Model Link href')\n\n      if (model) {\n        const loader = new ColladaLoader(manager)\n        return loader.parse(fflate.strFromU8(zip[model.textContent]))\n      }\n    } else {\n      console.warn('KMZLoader: Missing doc.kml file.')\n\n      for (const path in zip) {\n        const extension = path.split('.').pop().toLowerCase()\n\n        if (extension === 'dae') {\n          const loader = new ColladaLoader(manager)\n          return loader.parse(fflate.strFromU8(zip[path]))\n        }\n      }\n    }\n\n    console.error(\"KMZLoader: Couldn't find .dae file.\")\n    return { scene: new Group() }\n  }\n}\n\nexport { KMZLoader }\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}